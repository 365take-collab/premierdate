# ドメイン設定 - 最終確認

## ✅ 完了した作業

- [x] コード側の設定（next.config.ts、.env.example）
- [x] お名前.comでネームサーバーを設定
- [x] Vercelでドメインを追加
- [x] Vercel環境変数を設定
  - `NEXTAUTH_URL` = `https://premierdate.jp`
  - `NEXT_PUBLIC_BASE_URL` = `https://premierdate.jp`
  - `SMTP_FROM` = `noreply@premierdate.jp`

---

## 🔍 最終確認事項

### 1. 環境変数の環境設定を確認

Vercelの環境変数設定画面で、各環境変数が **Production環境** に設定されているか確認してください。

**確認方法**:
1. 各環境変数の行をクリック
2. **Environments** セクションで **Production** にチェックが入っているか確認
3. **Preview** と **Development** はチェックしない（開発環境では `localhost` を使用）

**推奨設定**:
- ✅ **Production**: チェック（本番環境で使用）
- ❌ **Preview**: チェックしない（プレビュー環境では `localhost` を使用）
- ❌ **Development**: チェックしない（開発環境では `localhost` を使用）

---

### 2. デプロイを再実行

環境変数を追加・変更した後、デプロイを再実行して変更を反映します。

#### 方法A: Vercelダッシュボードから再デプロイ

1. **Deployments** タブを開く
2. 最新のデプロイメントの **...** メニューをクリック
3. **Redeploy** を選択
4. デプロイが完了するまで待つ（数分）

#### 方法B: GitHubから自動デプロイ（推奨）

```bash
cd /Users/kawamuratakeshi/Cursor/premier-date
git add .
git commit -m "ドメイン設定を追加"
git push
```

---

### 3. ドメインの反映確認（24-48時間後）

#### 3-1. Vercelダッシュボードで確認

1. **Settings** → **Domains** → **premierdate.jp**
2. **ドメインの状態** を確認
   - ✅ **Valid**: 正常に設定完了
   - ⏳ **Pending**: 設定中（反映待ち）
   - ❌ **Error**: エラー（設定を確認）

#### 3-2. コマンドラインで確認

```bash
cd /Users/kawamuratakeshi/Cursor/premier-date
./check_domain.sh
```

#### 3-3. ブラウザで確認

1. **ブラウザでアクセス**: `https://premierdate.jp`
2. **SSL証明書の確認**: ブラウザのアドレスバーで🔒マークを確認
3. **サイトが表示されるか確認**

---

## 📊 設定完了チェックリスト

### コード側の設定
- [x] `next.config.ts` にドメイン設定を追加
- [x] `.env.example` を更新

### ドメイン設定
- [x] お名前.comでネームサーバーを設定
- [x] Vercelでドメインを追加

### 環境変数設定
- [x] `NEXTAUTH_URL` を設定
- [x] `NEXT_PUBLIC_BASE_URL` を設定
- [x] `SMTP_FROM` を設定
- [ ] **環境変数がProduction環境に設定されているか確認** ← 重要

### デプロイ
- [ ] デプロイを再実行
- [ ] デプロイが成功したことを確認

### 動作確認（24-48時間後）
- [ ] `https://premierdate.jp` でアクセスできる
- [ ] SSL証明書が有効（🔒マークが表示される）
- [ ] サイトが正常に表示される
- [ ] メール認証リンクが正しいドメインになっている

---

## 🐛 トラブルシューティング

### 問題1: 環境変数が反映されない

**原因**: 環境変数がProduction環境に設定されていない、またはデプロイが再実行されていない

**解決策**:
1. 環境変数の設定画面で、各環境変数が **Production** にチェックされているか確認
2. デプロイを再実行
3. デプロイログで環境変数が読み込まれているか確認

### 問題2: メールリンクがlocalhostになっている

**原因**: 環境変数が正しく設定されていない、またはデプロイが再実行されていない

**解決策**:
1. Vercelの環境変数を確認（`NEXTAUTH_URL`が`https://premierdate.jp`になっているか）
2. Production環境に設定されているか確認
3. デプロイを再実行

### 問題3: ドメインが反映されない（48時間以上経過）

**原因**: ネームサーバーの設定が正しく反映されていない可能性

**解決策**:
1. お名前.comの管理画面でネームサーバー設定を再確認
2. Vercelの管理画面でドメインの状態を確認
3. コマンドラインで確認:
   ```bash
   dig NS premierdate.jp
   ```
   結果に `ns1.vercel-dns.com` と `ns2.vercel-dns.com` が表示されるか確認

---

## 🔗 参考リンク

- **Vercelダッシュボード**: https://vercel.com/dashboard
- **Vercel環境変数設定**: https://vercel.com/docs/concepts/projects/environment-variables
- **Vercelドメイン設定**: https://vercel.com/docs/concepts/projects/domains

---

**更新日**: 2025年12月31日
