# 既存レビューのリライト手順

## 概要

食べログから取り込んだ既存の135件のレビューをOpenAI APIでリライトします。

## 前提条件

1. OpenAI APIキーが必要です
   - https://platform.openai.com/api-keys から取得
   - .envファイルに `OPENAI_API_KEY=sk-proj-xxxxx` の形式で追加

## 実行手順

### 1. APIキーの設定

.envファイルにOpenAI APIキーを追加します：

```bash
echo 'OPENAI_API_KEY=sk-proj-your-api-key-here' >> .env
```

または、エディタで.envファイルを開いて以下を追加：

```
OPENAI_API_KEY=sk-proj-your-api-key-here
```

### 2. テストモードで実行（推奨）

まず、最初の10件だけをテストします：

```bash
npm run rewrite:reviews:test
```

### 3. 本番モードで実行

問題がなければ、全てのレビューをリライトします：

```bash
npm run rewrite:reviews
```

## 処理内容

1. `user_id`がnullのレビュー（外部レビュー）を取得
2. OpenAI APIでデートガイド向けにリライト
3. データベースを更新
4. APIレート制限対策として1秒待機

## リライトの方針

- デートの雰囲気や体験を強調
- 元のレビューの内容を保持
- 自然な日本語に変換
- デートガイドサイトに適した表現

## 注意事項

- OpenAI APIの使用料金が発生します（gpt-4o-miniを使用）
- 135件のリライトで約$0.10-0.20程度
- APIレート制限対策として、1件ごとに1秒待機します
- 処理時間は約2-3分程度

## エラー時の対応

- APIキーが未設定の場合：エラーメッセージが表示されます
- API呼び出しエラー：元のテキストを保持し、次のレビューに進みます
- データベースエラー：エラーログが表示され、処理が中断されます

## 実行例

```bash
# テストモード
$ npm run rewrite:reviews:test

🌱 既存のレビューをリライトします...
📊 リライト対象レビュー数: 10件
🧪 テストモード: 最初の10件のみ処理します

[1/10] 鮨 一心
  元のレビュー: トルコ料理に挑戦地下にあってとても静かな店です...
  ✅ リライト後: トルコ料理を二人で楽しむのに最適な、静かな地下の隠れ家的なお店です...
  💾 データベースを更新しました

...

✅ 処理完了
📊 処理したレビュー数: 10件
📊 成功: 10件
📊 エラー: 0件
📊 スキップ: 0件
```

## 補足

- リライト後のレビューは即座にサイトに反映されます
- プレミアムユーザーのみが閲覧できます
- リライトしたレビューは `updated_at` が更新されます
