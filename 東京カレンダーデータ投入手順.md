# 東京カレンダーデータ投入手順

## 概要

スクレイピングした東京カレンダーのレストランデータをデータベースに投入する手順です。

## 前提条件

1. **データベース接続**: Supabaseに正常に接続できていること
2. **用途カテゴリの存在**: 先にシードスクリプトを実行して用途カテゴリを作成しておくこと
3. **JSONファイルの存在**: `scripts/tokyo-calendar-restaurants.json` が存在すること

## 手順

### 1. 用途カテゴリの確認・作成

用途カテゴリが存在しない場合は、先にシードスクリプトを実行してください：

```bash
cd premier-date
npm run db:seed
```

これにより、以下の用途カテゴリが作成されます：
- 初デート
- 誕生日
- 記念日
- カジュアルデート
- 夜のデート

### 2. データ投入スクリプトの実行

以下のコマンドでデータを投入します：

```bash
npm run db:import:tokyo-calendar
```

## スクリプトの動作

1. **JSONファイルの読み込み**: `scripts/tokyo-calendar-restaurants.json` を読み込みます
2. **重複チェック**: 既に存在する店舗（名前とエリアで判定）はスキップします
3. **価格帯の推定**: `description` から価格情報を抽出して価格帯を推定します
4. **緯度・経度の設定**: 
   - データに緯度・経度がある場合はそれを使用
   - ない場合はエリアのデフォルト座標を使用
5. **住所の整形**: 駅名のみの場合はエリア名を追加
6. **用途カテゴリの関連付け**: デフォルトで「カジュアルデート」を関連付けます

## 価格帯の推定ロジック

- **ディナーの価格情報**: `description` から「ディナー: 約15,000円」などの形式を抽出
- **ランチの価格情報**: ディナーがない場合はランチ価格を2倍して推定
- **価格帯の分類**:
  - 3,000円未満 → `UNDER_3000`
  - 3,000円以上5,000円未満 → `BETWEEN_3000_5000`
  - 5,000円以上10,000円未満 → `BETWEEN_5000_10000`
  - 10,000円以上 → `OVER_10000`
  - 価格情報がない場合 → `BETWEEN_3000_5000`（デフォルト）

## エリア別のデフォルト座標

緯度・経度が取得できていない店舗には、エリア別のデフォルト座標を設定します：

- 渋谷: 35.658034, 139.701636
- 新宿: 35.690921, 139.700258
- 池袋: 35.729502, 139.710900
- 恵比寿: 35.646690, 139.710106
- 六本木/港区: 35.662690, 139.731364
- 銀座: 35.671946, 139.765483
- 東京駅周辺: 35.681236, 139.767125
- 上野: 35.713768, 139.777254
- 表参道: 35.665412, 139.712677

## 実行結果の確認

スクリプト実行後、以下のコマンドでデータを確認できます：

```bash
# Prisma Studioで確認
npm run db:studio

# または、APIエンドポイントで確認
curl http://localhost:3000/api/restaurants
```

## 注意事項

1. **重複データ**: 同じ名前とエリアの店舗は自動的にスキップされます
2. **緯度・経度**: デフォルト座標を使用しているため、後でGoogle Maps Geocoding APIで正確な座標を取得することを推奨します
3. **住所**: 詳細な住所は取得できていないため、後で詳細ページから取得する必要があります
4. **デート特化情報**: 横並び席、客層、ホテルまでの距離などの情報は未取得です。後で手動で追加する必要があります

## 次のステップ

1. **詳細情報の取得**: 詳細ページから住所、緯度・経度を取得
2. **Google Maps Geocoding API**: 住所から正確な緯度・経度を取得
3. **デート特化情報の追加**: 横並び席、客層、ホテルまでの距離などの情報を手動で追加
4. **用途カテゴリの関連付け**: 各店舗に適切な用途カテゴリを関連付け
