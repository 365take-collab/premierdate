# デートガイド - データベースセットアップチェックリスト

## ✅ 完了した作業

- [x] Prismaスキーマの確認・修正（環境変数の設定を追加）
- [x] .env.exampleファイルの作成
- [x] セットアップ手順書の作成

## ⏭️ 次にやること（あなたが行う作業）

### Step 1: Supabaseでのプロジェクト作成

1. [Supabase](https://supabase.com/) にアクセス
2. アカウント作成（GitHubアカウント推奨）
3. 新しいプロジェクトを作成
   - **Name**: `date-guide`
   - **Database Password**: **強力なパスワードを設定**（必ずメモ！）
   - **Region**: `Tokyo (Northeast Asia)`
   - **Pricing Plan**: `Free`

### Step 2: 接続URLの取得

1. Supabaseダッシュボードで「Settings」→「Database」を開く
2. 「Connection string」セクションで「URI」を選択
3. 接続URLをコピー（例: `postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres`）
4. `[YOUR-PASSWORD]` を実際のパスワードに置き換える

### Step 3: 環境変数の設定

プロジェクトルート（`date-guide/`）に `.env` ファイルを作成し、以下を記述：

```env
# データベース接続URL（Step 2で取得したURL）
DATABASE_URL="postgresql://postgres:[実際のパスワード]@db.xxxxx.supabase.co:5432/postgres"

# NextAuth.js
# NEXTAUTH_SECRETは以下のコマンドで生成:
# openssl rand -base64 32
NEXTAUTH_SECRET="生成したシークレットをここに"
NEXTAUTH_URL="http://localhost:3000"
```

**NEXTAUTH_SECRETの生成方法**:
```bash
openssl rand -base64 32
```

このコマンドの出力を `NEXTAUTH_SECRET` に設定してください。

### Step 4: マイグレーションの実行

`.env` ファイルを作成したら、以下のコマンドを実行してください：

```bash
cd date-guide

# Prismaクライアントの生成
npm run db:generate

# データベースマイグレーション（テーブルを作成）
npm run db:migrate

# 初期データの投入（オプション）
npm run db:seed
```

### Step 5: 動作確認

```bash
# Prisma Studioでデータベースを確認（オプション）
npm run db:studio

# 開発サーバーの起動
npm run dev
```

---

## 📋 チェックリスト

Supabaseでのセットアップが完了したら、以下を確認してください：

- [ ] Supabaseでプロジェクトを作成した
- [ ] データベース接続URLを取得した
- [ ] `.env` ファイルを作成し、`DATABASE_URL` を設定した
- [ ] `NEXTAUTH_SECRET` を生成して設定した
- [ ] `npm run db:generate` を実行した（エラーがないか確認）
- [ ] `npm run db:migrate` を実行した（テーブルが作成されたか確認）
- [ ] `npm run db:seed` を実行した（初期データが投入されたか確認）
- [ ] `npm run dev` で開発サーバーが起動した

---

## 🔍 確認方法

### Supabaseでテーブルが作成されたか確認

1. Supabaseダッシュボードで「Table Editor」を開く
2. 以下のテーブルが作成されているか確認：
   - `users`
   - `accounts`
   - `sessions`
   - `verification_tokens`
   - `restaurants`
   - `reviews`
   - `favorites`
   - `date_courses`
   - `purpose_categories`
   - `restaurant_purposes`

### Prisma Studioで確認

```bash
npm run db:studio
```

ブラウザでPrisma Studioが開き、データベースの内容を確認できます。

---

## ❓ 困ったときは

### 接続エラーが発生する場合

1. `.env` ファイルの `DATABASE_URL` が正しいか確認
2. パスワードに特殊文字（`@`, `:`, `/` など）が含まれている場合は、URLエンコードが必要な場合があります
3. Supabaseダッシュボードの「Settings」→「Database」で接続情報を再確認

### マイグレーションエラーが発生する場合

1. Supabaseの「Table Editor」で既存のテーブルがないか確認
2. 既存のテーブルがある場合は、Supabaseダッシュボードから手動で削除するか、マイグレーションをリセットしてください

---

**セットアップが完了したら、「セットアップ完了しました」とお知らせください。次のステップ（認証機能の実装など）に進みます！**



