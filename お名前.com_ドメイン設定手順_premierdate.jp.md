# お名前.com - ドメイン設定手順（premierdate.jp）

## ✅ 前提条件

- **ドメイン**: `premierdate.jp` を取得済み
- **ドメイン取得サービス**: お名前.com
- **ホスティング**: Vercel

---

## 📋 設定手順の全体フロー

```
1. Vercelでドメインを追加
   ↓
2. お名前.comでネームサーバーを設定
   ↓
3. Vercel環境変数を設定
   ↓
4. デプロイを再実行
   ↓
5. 反映確認（24-48時間）
```

---

## 🚀 ステップ1: Vercelでドメインを追加

### 1-1. Vercelにログイン

1. **Vercelにアクセス**: https://vercel.com/
2. **ログイン**: GitHubアカウントでログイン
3. **ダッシュボード**: https://vercel.com/dashboard

### 1-2. プロジェクトを選択

1. **プロジェクト一覧**から `premier-date` を選択
   - プロジェクトが見つからない場合は、GitHubリポジトリから新規プロジェクトを作成

### 1-3. ドメインを追加

1. **Settings** タブをクリック
2. **Domains** セクションを開く
3. **Add Domain** ボタンをクリック
4. **ドメイン名を入力**: `premierdate.jp`
5. **Add** ボタンをクリック

### 1-4. ネームサーバー情報を確認

Vercelが以下のようなネームサーバー情報を表示します：

```
ネームサーバー:
- ns1.vercel-dns.com
- ns2.vercel-dns.com
```

**この情報をコピーしておきます**（次のステップで使用）

---

## 🔧 ステップ2: お名前.comでネームサーバーを設定

お名前.comでは、**ネームサーバーを変更する方法**（推奨）と**DNSレコードを直接設定する方法**の2つがあります。

### 方法A: ネームサーバーを変更する方法（推奨・簡単）

#### 2A-1. お名前.comにログイン

1. **お名前.comにアクセス**: https://www.onamae.com/
2. **ログイン**: お名前.comのアカウントでログイン
3. **ドメイン一覧**: https://www.onamae.com/domain/

#### 2A-2. ドメインを選択

1. **ドメイン一覧** を開く
2. **premierdate.jp** を選択
3. **ドメイン設定** または **ネームサーバー設定** をクリック

#### 2A-3. ネームサーバー設定画面を開く

1. **ネームサーバー設定** または **DNS設定** を選択
2. **カスタムネームサーバー** または **外部ネームサーバー** を選択

#### 2A-4. Vercelのネームサーバーを入力

お名前.comの管理画面で、以下のネームサーバーを入力：

**ネームサーバー1**: `ns1.vercel-dns.com`
**ネームサーバー2**: `ns2.vercel-dns.com`

**注意**: 
- 末尾にピリオド（.）は不要です
- 大文字・小文字は区別されませんが、正確に入力してください
- お名前.comによっては、ネームサーバー3、4も入力できる場合がありますが、Vercelは2つで十分です

#### 2A-5. 設定を保存

1. **確認** ボタンをクリック
2. **保存** または **適用** ボタンをクリック
3. 設定完了のメッセージを確認

#### 2A-6. 設定の反映確認

- **反映時間**: 通常24-48時間以内に反映されます
- **確認方法**: Vercelの管理画面でドメインの状態を確認

---

### 方法B: DNSレコードを直接設定する方法（上級者向け）

ネームサーバーを変更できない場合や、お名前.comのDNS機能を使いたい場合に使用します。

#### 2B-1. VercelでDNSレコード情報を確認

1. **Vercelダッシュボード** → **Settings** → **Domains** → **premierdate.jp**
2. **DNS Records** タブを開く
3. 以下の情報をメモ：
   - **Aレコード**のIPアドレス（例: `76.76.21.21`）
   - **CNAMEレコード**の値（例: `cname.vercel-dns.com`）

#### 2B-2. お名前.comでDNSレコードを設定

1. **お名前.comにログイン**: https://www.onamae.com/
2. **ドメイン一覧** → **premierdate.jp** を選択
3. **ドメイン設定** → **DNS関連機能の設定** を選択
4. **DNSレコード設定を利用する** を選び、**設定する** をクリック

#### 2B-3. Aレコードを追加

- **ホスト名**: 空欄（または `@`）
- **TYPE**: `A`
- **VALUE**: Vercelで確認したAレコードのIPアドレス
- **TTL**: `3600`（デフォルト値）

#### 2B-4. CNAMEレコードを追加（wwwサブドメインを使用する場合）

- **ホスト名**: `www`
- **TYPE**: `CNAME`
- **VALUE**: Vercelで確認したCNAMEの値
- **TTL**: `3600`（デフォルト値）

#### 2B-5. 設定を保存

1. **保存** ボタンをクリック
2. 設定完了のメッセージを確認

**注意**: 方法A（ネームサーバー変更）の方が簡単で推奨です。

---

## 🔐 ステップ3: Vercel環境変数を設定

### 3-1. 環境変数設定画面を開く

1. **Vercelダッシュボード** → **Settings** → **Environment Variables** に移動
2. **Add New** ボタンをクリック

### 3-2. NEXTAUTH_URL を設定

1. **Key**: `NEXTAUTH_URL`
2. **Value**: `https://premierdate.jp`
3. **Environment**: **Production** を選択（✅チェック）
4. **Save** ボタンをクリック

### 3-3. NEXT_PUBLIC_BASE_URL を設定

1. **Add New** ボタンをクリック
2. **Key**: `NEXT_PUBLIC_BASE_URL`
3. **Value**: `https://premierdate.jp`
4. **Environment**: **Production** を選択（✅チェック）
5. **Save** ボタンをクリック

### 3-4. SMTP_FROM を設定

1. **Add New** ボタンをクリック
2. **Key**: `SMTP_FROM`
3. **Value**: `noreply@premierdate.jp`
4. **Environment**: **Production** を選択（✅チェック）
5. **Save** ボタンをクリック

### 3-5. 環境変数の確認

以下の環境変数が設定されているか確認：

- ✅ `NEXTAUTH_URL` = `https://premierdate.jp` (Production)
- ✅ `NEXT_PUBLIC_BASE_URL` = `https://premierdate.jp` (Production)
- ✅ `SMTP_FROM` = `noreply@premierdate.jp` (Production)

---

## 🚀 ステップ4: デプロイを再実行

環境変数を追加した後、デプロイを再実行して変更を反映します。

### 4-1. Vercelダッシュボードから再デプロイ

1. **Deployments** タブを開く
2. 最新のデプロイメントの **...** メニューをクリック
3. **Redeploy** を選択
4. デプロイが完了するまで待つ（数分）

### 4-2. GitHubから自動デプロイ（推奨）

```bash
cd /Users/kawamuratakeshi/Cursor/premier-date
git add .
git commit -m "ドメイン設定を追加"
git push
```

GitHubにプッシュすると、Vercelが自動的にデプロイを実行します。

---

## ✅ ステップ5: ドメインの反映確認

### 5-1. Vercelダッシュボードで確認

1. **Settings** → **Domains** → **premierdate.jp**
2. **ドメインの状態** を確認
   - ✅ **Valid**: 正常に設定完了
   - ⏳ **Pending**: 設定中（反映待ち）
   - ❌ **Error**: エラー（設定を確認）

### 5-2. コマンドラインで確認

```bash
cd /Users/kawamuratakeshi/Cursor/premier-date
./check_domain.sh
```

または、個別に確認：

```bash
# DNSレコードの確認
nslookup premierdate.jp

# ネームサーバーの確認
dig NS premierdate.jp

# SSL証明書の確認
openssl s_client -connect premierdate.jp:443 -servername premierdate.jp
```

### 5-3. ブラウザで確認

1. **ブラウザでアクセス**: `https://premierdate.jp`
2. **SSL証明書の確認**: ブラウザのアドレスバーで🔒マークを確認
3. **サイトが表示されるか確認**

---

## 🐛 トラブルシューティング（お名前.com特化）

### 問題1: お名前.comでネームサーバー設定が見つからない

**原因**: お名前.comの管理画面の構成が変更されている可能性

**解決方法**:
1. **ドメイン一覧** → **premierdate.jp** を選択
2. **ドメイン設定** → **DNS設定** → **ネームサーバー設定** を探す
3. または、**お名前.comサポート** に問い合わせ: https://www.onamae.com/support/

### 問題2: ネームサーバー設定が保存できない

**原因**: 入力形式が間違っている可能性

**解決方法**:
1. **ネームサーバー1**: `ns1.vercel-dns.com`（末尾にピリオドなし）
2. **ネームサーバー2**: `ns2.vercel-dns.com`（末尾にピリオドなし）
3. 大文字・小文字を確認
4. スペースや特殊文字が入っていないか確認

### 問題3: ドメインが反映されない（48時間以上経過）

**原因**: ネームサーバーの設定が正しく反映されていない可能性

**解決方法**:
1. **お名前.comの管理画面**でネームサーバー設定を再確認
2. **Vercelの管理画面**でドメインの状態を確認
3. **コマンドラインで確認**:
   ```bash
   dig NS premierdate.jp
   ```
   結果に `ns1.vercel-dns.com` と `ns2.vercel-dns.com` が表示されるか確認
4. **お名前.comサポート** に問い合わせ

### 問題4: SSL証明書が発行されない

**原因**: DNSレコードの反映が完了していない

**解決方法**:
1. **DNSレコードの反映を確認**: `nslookup premierdate.jp` で確認
2. **Vercelの管理画面で再試行**: **Settings** → **Domains** → **premierdate.jp** → **Retry SSL**
3. 最大48時間待つ

### 問題5: メールリンクがlocalhostになっている

**原因**: 環境変数が正しく設定されていない

**解決策**:
1. Vercelの環境変数を確認（`NEXTAUTH_URL`が`https://premierdate.jp`になっているか）
2. 本番環境（Production）に設定されているか確認
3. デプロイを再実行

---

## 📊 設定完了後の確認チェックリスト

### お名前.com設定
- [ ] お名前.comにログイン
- [ ] ドメイン一覧から `premierdate.jp` を選択
- [ ] ネームサーバー設定を開く
- [ ] カスタムネームサーバーを選択
- [ ] `ns1.vercel-dns.com` を入力
- [ ] `ns2.vercel-dns.com` を入力
- [ ] 設定を保存

### Vercel設定
- [ ] Vercelでドメインを追加
- [ ] ネームサーバー情報を確認
- [ ] 環境変数を設定（3つ）
- [ ] デプロイを再実行

### 動作確認
- [ ] `https://premierdate.jp` でアクセスできる
- [ ] SSL証明書が有効（🔒マークが表示される）
- [ ] サイトが正常に表示される
- [ ] メール認証リンクが正しいドメインになっている

---

## 🔗 参考リンク

### お名前.com
- **お名前.com**: https://www.onamae.com/
- **お名前.comサポート**: https://www.onamae.com/support/
- **ドメイン一覧**: https://www.onamae.com/domain/

### Vercel
- **Vercelダッシュボード**: https://vercel.com/dashboard
- **Vercelドメイン設定ガイド**: https://vercel.com/docs/concepts/projects/domains
- **Vercel環境変数設定**: https://vercel.com/docs/concepts/projects/environment-variables
- **Vercelサポート**: https://vercel.com/support

### DNS確認ツール
- **DNS Checker**: https://dnschecker.org/
- **What's My DNS**: https://www.whatsmydns.net/

---

## 📝 メモ

### 設定情報

**ドメイン**: premierdate.jp
**ドメイン取得サービス**: お名前.com
**Vercelプロジェクト**: premier-date
**ネームサーバー1**: ns1.vercel-dns.com
**ネームサーバー2**: ns2.vercel-dns.com

**環境変数（Production）**:
- `NEXTAUTH_URL` = `https://premierdate.jp`
- `NEXT_PUBLIC_BASE_URL` = `https://premierdate.jp`
- `SMTP_FROM` = `noreply@premierdate.jp`

### 設定完了日
- **設定開始日**: [記入]
- **設定完了日**: [記入]
- **反映確認日**: [記入]

---

**作成日**: 2025年12月31日
**ドメイン**: premierdate.jp
**ドメイン取得サービス**: お名前.com
**ホスティング**: Vercel
