# シーシャバー検索スクリプト実行手順

## 概要

ハッピーホテルサイトから取得したラブホテル情報から、100m以内のシーシャバーを検索してデータベースに追加するスクリプトです。

## 必要な準備

### 1. Google Maps API キーの取得と設定

1. **Google Cloud Console**にアクセス
   - https://console.cloud.google.com/

2. **新しいプロジェクトを作成**（または既存のプロジェクトを選択）

3. **以下のAPIを有効化**
   - **Geocoding API**: 住所から緯度・経度を取得
   - **Places API (New)**: 周辺の場所を検索

4. **APIキーを作成**
   - 「認証情報」→「認証情報を作成」→「APIキー」

5. **`.env`ファイルに設定**
   ```env
   GOOGLE_MAPS_API_KEY=あなたのAPIキー
   ```

### 2. ラブホテルデータの準備

`scripts/love-hotels.json`にラブホテル情報が保存されていることを確認します。

```bash
npm run scrape:love-hotels
```

これで`scripts/love-hotels.json`にラブホテル情報が保存されます。

## 実行方法

```bash
npm run collect:shisha-bars
```

## 処理内容

1. **ラブホテル情報の読み込み**
   - `scripts/love-hotels.json`からラブホテル情報を読み込み
   - 緯度・経度がない場合は、Geocoding APIで取得

2. **シーシャバーの検索**
   - 各ラブホテルから100m以内のシーシャバーを検索
   - 以下のキーワードで検索：
     - `シーシャバー`
     - `シーシャ バー`
     - `shisha bar`
     - `水タバコ`

3. **データベースへの追加**
   - 検索結果をデータベースに追加
   - 重複チェック（名前+住所）
   - 用途カテゴリとの関連付け（夜のデート、カジュアルデート）

## 注意事項

- **APIレート制限**: Google Maps APIにはリクエスト数の制限があります
- **処理時間**: ラブホテル数が多い場合、処理に時間がかかります（APIレート制限を避けるため、各リクエスト間に200msの待機時間を設定）
- **エラーハンドリング**: GeocodingやPlaces APIでエラーが発生した場合、そのホテルはスキップされます

## 実行結果の確認

スクリプト実行後、以下の方法で結果を確認できます：

```bash
npm run db:studio
```

Prisma Studioで`Restaurant`テーブルを確認し、シーシャバーが追加されているか確認してください。



