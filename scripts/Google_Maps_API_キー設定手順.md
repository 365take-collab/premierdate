# Google Maps API キー設定手順

## 概要

シーシャバー検索スクリプトを実行するために、Google Maps API キーが必要です。
以下のAPIを有効化する必要があります：
- **Geocoding API**: 住所から緯度・経度を取得
- **Places API (New)**: 周辺の場所を検索

## 手順

### 1. Google Cloud Console にアクセス

1. **Google Cloud Console**にアクセス
   - https://console.cloud.google.com/

2. **Googleアカウントでログイン**
   - 使用するGoogleアカウントでログインしてください

### 2. プロジェクトの作成（または選択）

1. **プロジェクトを作成**
   - 画面上部の「プロジェクトを選択」をクリック
   - 「新しいプロジェクト」をクリック
   - プロジェクト名を入力（例: `date-guide`）
   - 「作成」をクリック

2. **既存のプロジェクトを使用する場合**
   - 画面上部の「プロジェクトを選択」から既存のプロジェクトを選択

### 3. APIの有効化

1. **Geocoding API を有効化**
   - 左側のメニューから「APIとサービス」→「ライブラリ」を選択
   - 検索ボックスに「Geocoding API」と入力
   - 「Geocoding API」を選択
   - 「有効にする」をクリック

2. **Places API (New) を有効化**
   - 左側のメニューから「APIとサービス」→「ライブラリ」を選択
   - 検索ボックスに「Places API (New)」と入力
   - 「Places API (New)」を選択
   - 「有効にする」をクリック

   **注意**: 「Places API」ではなく「Places API (New)」を選択してください

### 4. APIキーの作成

1. **認証情報ページに移動**
   - 左側のメニューから「APIとサービス」→「認証情報」を選択

2. **APIキーを作成**
   - 「認証情報を作成」→「APIキー」をクリック
   - APIキーが作成されます（ポップアップに表示されます）

3. **APIキーをコピー**
   - 表示されたAPIキーをコピーしてください
   - 例: `AIzaSyA1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q`

### 5. 課金アカウントの設定（初回のみ）

1. **課金アカウントのリンク**
   - Google Cloudは無料トライアルを提供しています
   - ただし、APIキーを使用するには課金アカウントをリンクする必要があります
   - 初回のみ、課金アカウントの設定を求められます

2. **無料枠について**
   - Geocoding API: 月間 $200 の無料クレジット（約 40,000 リクエスト）
   - Places API (New): 月間 $200 の無料クレジット
   - 小規模な使用であれば、無料枠内で十分です

### 6. `.env`ファイルに設定

1. **`.env`ファイルを開く**
   - `date-guide/.env`ファイルを開きます

2. **APIキーを追加**
   ```env
   GOOGLE_MAPS_API_KEY=AIzaSyA1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q
   ```
   - `AIzaSy...`の部分を、先ほどコピーしたAPIキーに置き換えてください

3. **ファイルを保存**

### 7. 設定の確認

以下のコマンドで、APIキーが正しく設定されているか確認できます：

```bash
cd date-guide
grep GOOGLE_MAPS_API_KEY .env
```

正しく設定されていれば、APIキーが表示されます。

## セキュリティのベストプラクティス（オプション）

### APIキーの制限（推奨）

1. **APIキーの制限を設定**
   - 「APIとサービス」→「認証情報」→作成したAPIキーをクリック
   - 「アプリケーションの制限」を設定
     - 「HTTP リファラー」を選択
     - 許可するドメインを追加（本番環境の場合）
   - 「APIの制限」を設定
     - 「キーを制限」を選択
     - 「Geocoding API」と「Places API (New)」のみを許可

2. **開発環境では制限なしでも可**
   - 開発・テスト段階では、制限なしでも問題ありません
   - 本番環境では必ず制限を設定してください

## トラブルシューティング

### APIキーが無効と表示される

- APIが正しく有効化されているか確認
- 課金アカウントがリンクされているか確認
- APIキーが正しく設定されているか確認

### リクエスト制限に達した

- 無料枠の使用量を確認
- 必要に応じて、APIリクエスト数を減らすか、課金を有効化

### Places APIが見つからない

- 「Places API (New)」を検索してください
- 「Places API」ではなく「Places API (New)」を使用してください

## 次のステップ

APIキーを設定したら、以下のコマンドでシーシャバー検索を実行できます：

```bash
npm run collect:shisha-bars
```



